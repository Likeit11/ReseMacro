# ReseMara 매크로 프로젝트

## 1. 프로젝트 개요
이 프로젝트는 ADB(Android Debug Bridge)를 이용하여 안드로이드 앱을 자동으로 제어하는 이미지 인식 기반 매크로입니다.

가장 큰 특징은 **모듈화된 구조**와 **상태 기반 실행 엔진**입니다.
- **모듈화된 구조**: 매크로의 동작 순서가 코드와 분리되어 있어, 코딩 경험이 적은 사용자도 쉽게 자신만의 매크로를 만들고 수정할 수 있습니다.
- **상태 기반 실행 엔진**: 매크로의 진행 상태를 자동으로 파일에 저장합니다. 만약 오류가 발생하거나 프로그램이 중단되어도, 다음 실행 시 마지막으로 성공했던 지점부터 자동으로 이어서 실행하여 안정성을 높였습니다.

## 2. 프로젝트 구조
프로젝트는 다음과 같은 파일과 폴더로 구성되어 있습니다.

- `Source/`: 메인 소스 코드가 위치하는 폴더입니다.
  - `ReseMara.py`: ADB 연결, 화면 캡처, 클릭 등 안드로이드 장치와 직접 상호작용하는 저수준 기능들을 담당합니다. (거의 수정할 필요 없음)
  - `macro_engine.py`: 매크로의 전체 흐름(상태)을 관리하고 실행하는 핵심 엔진입니다. (거의 수정할 필요 없음)
  - `macro_flow.py`: **사용자가 주로 수정할 파일**입니다. 이 파일에서 매크로의 실제 동작 순서와 내용을 정의합니다.

- `Ref_Img/`: 매크로가 화면에서 찾을 참조 이미지(`png` 파일)들을 저장하는 폴더입니다.

- `README.md`: 현재 읽고 계신 이 파일입니다. 프로젝트에 대한 설명서입니다.

- `progress.json`: 매크로 실행 중 진행 상황이 자동으로 기록되는 파일입니다. 이 파일이 있으면 중단된 부분부터 재시작하며, **파일을 삭제하면 매크로가 처음부터 다시 시작됩니다.**

## 3. 설치 및 실행 방법

### 요구사항
- Python 3.x
- ADB (Android Debug Bridge): MuMu, LDPlayer 등 대부분의 앱 플레이어에 내장되어 있습니다.

### 라이브러리 설치
프로젝트 실행에 필요한 라이브러리들을 아래 명령어로 설치합니다.
```bash
pip install opencv-python numpy adb-shell Pillow
```

### 실행
1.  안드로이드 앱 플레이어(예: MuMu)를 실행하고 ADB가 활성화되어 있는지 확인합니다.
2.  터미널(명령 프롬프트)에서 아래 명령어를 입력하여 매크로를 실행합니다.
    ```bash
    python Source/ReseMara.py
    ```
3.  "MuMu Player의 ADB 포트를 입력하세요" 라는 메시지가 나타나면, 사용 중인 앱 플레이어의 ADB 포트 번호(예: 16384)를 입력하고 Enter를 누릅니다. (Enter만 누르면 미리 정의된 포트 목록에서 자동으로 찾습니다.)

## 4. 초보자 가이드: 나만의 매크로 만들기
이 매크로는 `Ref_Img` 폴더의 이미지와 `macro_flow.py` 파일의 지시사항, 이 두 가지를 조합하여 작동합니다.

### 4.1. 이미지 준비하기
매크로가 화면에서 특정 버튼을 찾아 클릭하게 하려면, 그 버튼의 이미지가 필요합니다.

1.  매크로가 클릭했으면 하는 화면을 캡처합니다. (예: 게임의 '상점' 버튼)
2.  그림판이나 포토샵 같은 이미지 편집 프로그램을 사용하여, 캡처한 스크린샷에서 **클릭할 대상(버튼 등)만 정확하게 잘라냅니다.**
3.  잘라낸 이미지를 `Ref_Img/` 폴더에 저장합니다. 파일 이름은 `shop_button.png`와 같이 알아보기 쉬운 영어 이름으로 짓는 것이 좋습니다.

### 4.2. 매크로 흐름 수정하기 (`macro_flow.py`)
이제 준비된 이미지를 이용해 실제 매크로 동작을 만들어 보겠습니다. `Source/macro_flow.py` 파일을 텍스트 편집기로 열어주세요.

파일 안에는 `MACRO_FLOW` 라는 큰 딕셔너리(dictionary)가 있습니다. 이 딕셔너리는 여러 "상태(State)"로 구성되어 있고, 각 상태는 여러 "행동(Action)" 목록을 가집니다. 엔진은 이 상태들을 순서대로 실행합니다.

#### 예시 1: 앱 시작 후, 내가 만든 상점 버튼 클릭하기
`INITIAL_SETUP` 상태의 마지막에 '상점 버튼 클릭' 행동을 추가해 보겠습니다.

```python
# macro_flow.py

MACRO_FLOW = {
    "INITIAL_SETUP": [
        {'action': 'sequence', 'params': {'wait_image': 'app_icon'}, 'comment': 'Launch app'},
        {'action': 'sequence', 'params': {'wait_image': 'title_start'}, 'comment': 'Click start button on title screen', 'optional': True},
        {'action': 'sequence', 'params': {'wait_image': 'title_start'}, 'comment': 'Retry click start button'},
        {'action': 'sequence', 'params': {'wait_image': 'guest_login'}, 'comment': 'Click guest login'},

        # <<< 여기에 새로운 행동을 추가합니다! >>>
        {'action': 'sequence', 'params': {'wait_image': 'shop_button', 'wait_time': 3}, 'comment': '상점 버튼 클릭 후 3초 대기'}
    ],
    # ... 다른 상태들 ...
}
```
- `'action': 'sequence'` : 이미지를 찾아서 클릭하는 가장 기본적인 행동입니다.
- `'params': {'wait_image': 'shop_button', 'wait_time': 3}`: 행동에 필요한 파라미터입니다.
  - `wait_image`: `Ref_Img` 폴더에 저장한 이미지의 파일 이름(확장자 `.png` 제외)을 적습니다.
  - `wait_time`: 이미지를 클릭한 후 다음 행동으로 넘어가기 전에 기다릴 시간(초)입니다. (선택사항, 기본값 5초)
- `'comment'`: 이 행동이 무엇을 하는지 적는 주석입니다. (실행에 영향 없음)

#### 예시 2: 특정 좌표 클릭하기
이미지로 찾기 어려운 경우, 화면의 특정 좌표를 직접 클릭할 수도 있습니다. (좌표는 앱 플레이어 설정 등에서 확인 가능)

```python
# 특정 상태에 아래 행동을 추가
{'action': 'click_position', 'params': {'x': 100, 'y': 450, 'wait_time': 2}, 'comment': '화면 좌측 상단 클릭 후 2초 대기'}
```
- `'action': 'click_position'`: 지정된 좌표를 클릭하는 행동입니다.
- `'params'`:
  - `x`, `y`: 클릭할 화면의 x, y 좌표.
  - `wait_time`: 클릭 후 대기할 시간(초).

## 5. 핵심 기능: 상태 저장 및 복구
- **자동 저장**: 매크로 엔진은 하나의 행동을 성공적으로 마칠 때마다 `progress.json` 파일에 현재 위치를 자동으로 기록합니다.
- **자동 복구**: 만약 매크로가 중간에 멈췄다가 다시 실행되면, 엔진은 `progress.json` 파일을 확인하여 마지막으로 멈췄던 부분부터 이어서 작업을 재개합니다.
- **초기화**: 매크로를 처음부터 다시 실행하고 싶다면, 프로젝트 폴더에 있는 `progress.json` 파일을 직접 삭제하면 됩니다.